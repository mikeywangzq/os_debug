# ğŸ‰ OS è°ƒè¯•åŠ©æ‰‹ v2.0 å‘å¸ƒè¯´æ˜

**å‘å¸ƒæ—¥æœŸ**: 2025-11-17
**ç‰ˆæœ¬**: 2.0.0
**ä»£å·**: Real-time Debugger

---

## ğŸš€ ä¸»è¦æ–°åŠŸèƒ½

### âš¡ å®æ—¶ GDB é›†æˆ

v2.0 æœ€å¤§çš„äº®ç‚¹æ˜¯å…¨æ–°çš„å®æ—¶ GDB é›†æˆåŠŸèƒ½ï¼Œè®©ä½ èƒ½å¤Ÿï¼š

#### ğŸ”Œ å®æ—¶è¿æ¥
- è¿æ¥åˆ°è¿è¡Œä¸­çš„ GDB ä¼šè¯ï¼ˆæ”¯æŒ xv6/QEMU ç­‰ï¼‰
- æ”¯æŒè¿œç¨‹ GDB ç›®æ ‡ï¼ˆlocalhost:1234ï¼‰
- æ”¯æŒæœ¬åœ°å¯æ‰§è¡Œæ–‡ä»¶è°ƒè¯•
- WebSocket åŒå‘é€šä¿¡ï¼Œé›¶å»¶è¿Ÿ

#### ğŸ” è‡ªåŠ¨å´©æºƒæ£€æµ‹
- ç¨‹åºå´©æºƒæ—¶è‡ªåŠ¨æ•è·
  - å®Œæ•´è°ƒç”¨æ ˆï¼ˆbacktraceï¼‰
  - æ‰€æœ‰å¯„å­˜å™¨çŠ¶æ€
  - å½“å‰å¸§è¯¦ç»†ä¿¡æ¯
  - ä¿¡å·ä¿¡æ¯ï¼ˆSIGSEGV ç­‰ï¼‰
- è‡ªåŠ¨è§¦å‘é™æ€åˆ†æå¼•æ“
- å®æ—¶ç”Ÿæˆå‡è®¾å’Œå»ºè®®

#### ğŸ® äº¤äº’å¼è°ƒè¯•
- **æ§åˆ¶å‘½ä»¤**
  - Continue: ç»§ç»­æ‰§è¡Œ
  - Step Over: å•æ­¥æ‰§è¡Œï¼ˆè·³è¿‡å‡½æ•°ï¼‰
  - Step Into: å•æ­¥æ‰§è¡Œï¼ˆè¿›å…¥å‡½æ•°ï¼‰
- **ä¿¡æ¯æŸ¥è¯¢**
  - Get Backtrace: æŸ¥çœ‹è°ƒç”¨æ ˆ
  - Get Registers: æŸ¥çœ‹å¯„å­˜å™¨
- **æ–­ç‚¹ç®¡ç†**
  - æ”¯æŒå‡½æ•°åæ–­ç‚¹ï¼ˆå¦‚ panicï¼‰
  - æ”¯æŒæ–‡ä»¶:è¡Œå·æ–­ç‚¹ï¼ˆå¦‚ main.c:42ï¼‰
  - æ”¯æŒåœ°å€æ–­ç‚¹ï¼ˆå¦‚ *0x80000000ï¼‰

#### ğŸ“Š å®æ—¶å¯è§†åŒ–
- å½©è‰²äº‹ä»¶åˆ†ç±»
  - ğŸ”µ Info: ä¸€èˆ¬ä¿¡æ¯
  - ğŸŸ¢ Success: æˆåŠŸæ“ä½œ
  - ğŸŸ¡ Warning: è­¦å‘Šï¼ˆæ–­ç‚¹å‘½ä¸­ï¼‰
  - ğŸ”´ Error: é”™è¯¯ä¿¡æ¯
  - âš ï¸ Crash: å´©æºƒæ£€æµ‹ï¼ˆé«˜äº®ï¼‰
- æ—¶é—´æˆ³æ ‡è®°
- è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°å†…å®¹
- ç»“æ„åŒ–ä¿¡æ¯å±•ç¤º

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯æ–°å¢æ¨¡å—

#### 1. GDB Bridge (`backend/gdb/gdb_bridge.py`)
```python
class GDBBridge:
    - start(): å¯åŠ¨ GDB è¿›ç¨‹
    - connect_to_target(): è¿æ¥åˆ°ç›®æ ‡
    - execute_mi_command(): æ‰§è¡Œ MI å‘½ä»¤
    - execute_cli_command(): æ‰§è¡Œ CLI å‘½ä»¤
    - get_backtrace(): è·å–è°ƒç”¨æ ˆ
    - get_registers(): è·å–å¯„å­˜å™¨
    - set_breakpoint(): è®¾ç½®æ–­ç‚¹
    - continue_execution(): ç»§ç»­æ‰§è¡Œ
    - step_over() / step_into(): å•æ­¥æ‰§è¡Œ
```

**æŠ€æœ¯**: pygdbmi åº“ï¼ŒGDB/MI åè®®

#### 2. GDB Monitor (`backend/gdb/gdb_monitor.py`)
```python
class GDBMonitor:
    - start_monitoring(): å¯åŠ¨ç›‘æ§çº¿ç¨‹
    - stop_monitoring(): åœæ­¢ç›‘æ§
    - _on_stopped(): ç¨‹åºåœæ­¢äº‹ä»¶å¤„ç†
    - _on_breakpoint_hit(): æ–­ç‚¹å‘½ä¸­å¤„ç†
    - _on_signal_received(): ä¿¡å·æ¥æ”¶å¤„ç†
    - _auto_capture_state(): è‡ªåŠ¨æ•è·çŠ¶æ€
```

**æŠ€æœ¯**: å¤šçº¿ç¨‹ï¼Œäº‹ä»¶é©±åŠ¨

#### 3. WebSocket Handler (`backend/gdb/websocket_handler.py`)
```python
class GDBSessionManager:
    - create_session(): åˆ›å»ºä¼šè¯
    - get_session(): è·å–ä¼šè¯
    - destroy_session(): é”€æ¯ä¼šè¯

WebSocket Events:
    - gdb_connect: è¿æ¥åˆ° GDB
    - gdb_command: æ‰§è¡Œå‘½ä»¤
    - gdb_breakpoint: è®¾ç½®æ–­ç‚¹
    - gdb_continue: ç»§ç»­æ‰§è¡Œ
    - gdb_get_backtrace: è·å–è°ƒç”¨æ ˆ
    - gdb_crash_detected: å´©æºƒæ£€æµ‹ï¼ˆæ¨é€ï¼‰
```

**æŠ€æœ¯**: Flask-SocketIOï¼Œeventlet

### å‰ç«¯æ–°å¢æ¨¡å—

#### 1. GDB Client (`frontend/gdb_client.js`)
```javascript
class GDBClient:
    - connect(): å»ºç«‹ WebSocket è¿æ¥
    - connectToTarget(): è¿æ¥åˆ° GDB ç›®æ ‡
    - executeCommand(): æ‰§è¡Œ GDB å‘½ä»¤
    - continue() / stepOver() / stepInto(): æ§åˆ¶æ‰§è¡Œ
    - getBacktrace() / getRegisters(): æŸ¥è¯¢ä¿¡æ¯
    - setBreakpoint(): è®¾ç½®æ–­ç‚¹
    - handleCrashEvent(): å¤„ç†å´©æºƒäº‹ä»¶
    - triggerAutomaticAnalysis(): è§¦å‘è‡ªåŠ¨åˆ†æ
```

#### 2. UI ç»„ä»¶
- **åŒæ ‡ç­¾ç•Œé¢**: é™æ€åˆ†æ + å®æ—¶ GDB
- **è¿æ¥æ§åˆ¶é¢æ¿**: ç›®æ ‡è¾“å…¥ã€è¿æ¥/æ–­å¼€æŒ‰é’®ã€çŠ¶æ€æŒ‡ç¤ºå™¨
- **å¿«é€Ÿæ“ä½œåŒº**: æ‰§è¡Œæ§åˆ¶ã€ä¿¡æ¯æŸ¥è¯¢ã€æ–­ç‚¹è®¾ç½®
- **å®æ—¶è¾“å‡ºæ˜¾ç¤º**: å½©è‰²äº‹ä»¶æµã€æ—¶é—´æˆ³ã€è‡ªåŠ¨æ»šåŠ¨

---

## ğŸ“¦ æ–°å¢ä¾èµ–

### Python åŒ…
```
pygdbmi==0.11.0.0          # GDB/MI åè®®åº“
flask-socketio==5.3.4      # WebSocket æ”¯æŒ
python-socketio==5.9.0     # Socket.IO å®ç°
eventlet==0.33.3           # å¼‚æ­¥ I/O åç«¯
```

### å‰ç«¯åº“
```
Socket.IO Client 4.5.4     # WebSocket å®¢æˆ·ç«¯ï¼ˆCDNï¼‰
```

---

## ğŸ“š æ–°å¢æ–‡æ¡£

1. **GDB_INTEGRATION_GUIDE.md** - ç”¨æˆ·ä½¿ç”¨æŒ‡å—
   - å¿«é€Ÿå¼€å§‹æ•™ç¨‹
   - å…¸å‹ä½¿ç”¨åœºæ™¯ï¼ˆxv6 è°ƒè¯•ã€æœ¬åœ°ç¨‹åºè°ƒè¯•ï¼‰
   - å¸¸è§é—®é¢˜è§£ç­”
   - é«˜çº§é…ç½®
   - æ•™å­¦å»ºè®®

2. **GDB_INTEGRATION_DESIGN.md** - æŠ€æœ¯è®¾è®¡æ–‡æ¡£
   - å®Œæ•´ç³»ç»Ÿæ¶æ„å›¾
   - æ•°æ®æµè¯´æ˜
   - æ ¸å¿ƒæ¨¡å— API æ–‡æ¡£
   - å·¥ä½œæµç¨‹è¯¦è§£
   - å®‰å…¨æ€§è€ƒè™‘

3. **test_gdb_integration.py** - é›†æˆæµ‹è¯•è„šæœ¬
   - æ¨¡å—å¯¼å…¥æµ‹è¯•
   - Flask-SocketIO åˆå§‹åŒ–æµ‹è¯•
   - ä¼šè¯ç®¡ç†æµ‹è¯•
   - WebSocket å¤„ç†å™¨æµ‹è¯•
   - GDB Bridge åŸºç¡€åŠŸèƒ½æµ‹è¯•

---

## ğŸ¯ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1: è°ƒè¯• xv6 å†…æ ¸

```bash
# ç»ˆç«¯ 1: å¯åŠ¨ xv6
cd xv6-riscv
make qemu-gdb

# ç»ˆç«¯ 2: å¯åŠ¨ GDB
riscv64-linux-gnu-gdb kernel/kernel
(gdb) target remote localhost:1234

# ç»ˆç«¯ 3: å¯åŠ¨è°ƒè¯•åŠ©æ‰‹
python3 backend/app.py

# æµè§ˆå™¨: http://localhost:5000
# 1. ç‚¹å‡» "âš¡ Real-time GDB" æ ‡ç­¾
# 2. Target: localhost:1234
# 3. ç‚¹å‡» "Connect"
# 4. ç‚¹å‡» "Continue"
# 5. åœ¨ xv6 ä¸­è§¦å‘å´©æºƒ
# 6. ç³»ç»Ÿè‡ªåŠ¨åˆ†æå¹¶æ˜¾ç¤ºç»“æœ
```

### åœºæ™¯ 2: è®¾ç½®æ–­ç‚¹è¿½è¸ª

```bash
# åœ¨ UI ä¸­ï¼š
1. è¿æ¥åˆ° GDB
2. Breakpoint location: "panic"
3. ç‚¹å‡» "Set Breakpoint"
4. ç‚¹å‡» "Continue"
5. å½“æ–­ç‚¹å‘½ä¸­æ—¶ï¼š
   - ç‚¹å‡» "Get Backtrace" æŸ¥çœ‹è°ƒç”¨æ ˆ
   - ç‚¹å‡» "Get Registers" æŸ¥çœ‹å¯„å­˜å™¨
   - ç‚¹å‡» "Step Into" å•æ­¥è°ƒè¯•
```

---

## âœ… æµ‹è¯•ç»“æœ

æ‰€æœ‰æµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ“

```
Testing GDB Integration Components...
==================================================

1. Testing module imports...
   âœ“ All GDB modules imported successfully

2. Testing Flask app initialization...
   âœ“ Flask-SocketIO initialized successfully

3. Testing GDB Session Manager...
   âœ“ Session manager works correctly

4. Testing WebSocket handler registration...
   âœ“ WebSocket handlers registered successfully

5. Testing GDB Bridge...
   âœ“ Bridge initialized (not connected)
   âœ“ GDB Bridge basic functionality works

==================================================
âœ… All tests passed! GDB integration is ready.
```

---

## ğŸ”„ å…¼å®¹æ€§

- âœ… **å‘åå…¼å®¹**: å®Œå…¨å…¼å®¹ v1.0 æ‰€æœ‰åŠŸèƒ½
- âœ… **æ— ç ´åæ€§æ›´æ”¹**: æ‰€æœ‰ç°æœ‰ API ä¿æŒä¸å˜
- âœ… **å¹³æ»‘å‡çº§**: ç›´æ¥æ›¿æ¢å³å¯ä½¿ç”¨æ–°åŠŸèƒ½
- âœ… **ç‹¬ç«‹æ¨¡å—**: æ–°åŠŸèƒ½ä½œä¸ºç‹¬ç«‹æ ‡ç­¾é¡µï¼Œä¸å½±å“åŸæœ‰å·¥ä½œæµ

---

## âš™ï¸ ç³»ç»Ÿè¦æ±‚

### æœ€ä½è¦æ±‚
- Python 3.7+
- GDB 7.0+ (æ”¯æŒ MI v2)
- ç°ä»£æµè§ˆå™¨ï¼ˆæ”¯æŒ WebSocketï¼‰

### æ¨èé…ç½®
- Python 3.9+
- GDB 8.0+
- Chrome/Firefox æœ€æ–°ç‰ˆ
- å¯¹äºäº¤å‰è°ƒè¯•ï¼šgdb-multiarch

### æ”¯æŒçš„æ¶æ„
- âœ… x86-32
- âœ… x86-64
- âœ… RISC-V
- â³ ARMï¼ˆè®¡åˆ’ä¸­ï¼‰

---

## ğŸ› å·²çŸ¥é™åˆ¶

1. **å¹¶å‘é™åˆ¶**: ä¸€ä¸ªä¼šè¯åŒæ—¶åªèƒ½è¿æ¥ä¸€ä¸ª GDB å®ä¾‹
2. **è¾“å‡ºé™åˆ¶**: è¶…é•¿è¾“å‡ºå¯èƒ½è¢«æˆªæ–­ï¼ˆæœ€å¤§ 1MBï¼‰
3. **å¹³å°é™åˆ¶**: Windows éœ€è¦ MinGW ç¯å¢ƒ
4. **ç½‘ç»œé™åˆ¶**: é»˜è®¤åªå…è®¸ localhost è¿æ¥ï¼ˆå®‰å…¨è€ƒè™‘ï¼‰

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **è¿æ¥å»¶è¿Ÿ**: < 200ms
- **äº‹ä»¶å“åº”**: < 50ms (WebSocket)
- **å´©æºƒæ£€æµ‹**: å®æ—¶ï¼ˆ< 100msï¼‰
- **è‡ªåŠ¨åˆ†æ**: 1-3 ç§’ï¼ˆå–å†³äºæ•°æ®é‡ï¼‰
- **å†…å­˜å ç”¨**: +30MBï¼ˆç›¸æ¯” v1.0ï¼‰

---

## ğŸ“ æ•™è‚²ä»·å€¼

v2.0 ç‰¹åˆ«é€‚åˆï¼š

1. **æ“ä½œç³»ç»Ÿè¯¾ç¨‹**
   - å®æ—¶å±•ç¤ºå†…æ ¸è°ƒè¯•è¿‡ç¨‹
   - è‡ªåŠ¨åˆ†æå¸¸è§ OS bug
   - æ”¯æŒ xv6/Pintos/JOS

2. **ç³»ç»Ÿç¼–ç¨‹è¯¾ç¨‹**
   - å¯è§†åŒ–ç¨‹åºæ‰§è¡Œæµç¨‹
   - ç†è§£æ ˆå¸§å’Œè°ƒç”¨çº¦å®š
   - å­¦ä¹  GDB è°ƒè¯•æŠ€å·§

3. **åµŒå…¥å¼ç³»ç»Ÿ**
   - è¿œç¨‹è°ƒè¯•æ”¯æŒ
   - å®æ—¶çŠ¶æ€ç›‘æ§
   - ç¡¬ä»¶æ–­ç‚¹ç®¡ç†

---

## ğŸ—ºï¸ è·¯çº¿å›¾

### v2.1 (è®¡åˆ’ä¸­)
- [ ] å¢å¼ºé”™è¯¯æ¨¡å¼åº“ï¼ˆæ–°å¢ 10+ bug æ¨¡å¼ï¼‰
- [ ] äº¤äº’å¼è°ƒè¯•å»ºè®®ç³»ç»Ÿ
- [ ] æºä»£ç ä¸Šä¸‹æ–‡æ˜¾ç¤º

### v2.2 (è®¡åˆ’ä¸­)
- [ ] è°ƒè¯•ä¼šè¯ç®¡ç†ï¼ˆä¿å­˜/æ¢å¤/åˆ†äº«ï¼‰
- [ ] å†…å­˜å¸ƒå±€å¯è§†åŒ–
- [ ] ARM æ¶æ„å®Œæ•´æ”¯æŒ

### v3.0 (æ„¿æ™¯)
- [ ] å¤š GDB å®ä¾‹æ”¯æŒ
- [ ] åä½œè°ƒè¯•åŠŸèƒ½
- [ ] AI é©±åŠ¨çš„è‡ªåŠ¨ä¿®å¤å»ºè®®

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼

- ğŸ› æŠ¥å‘Š Bug
- ğŸ’¡ æå‡ºæ–°åŠŸèƒ½å»ºè®®
- ğŸ“– æ”¹è¿›æ–‡æ¡£
- ğŸ’» æäº¤ Pull Request

---

## ğŸ“„ è®¸å¯è¯

MIT License - è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘

---

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š

- **pygdbmi** - GDB/MI åè®®å®ç°
- **Flask-SocketIO** - WebSocket æ”¯æŒ
- **Socket.IO** - å®æ—¶é€šä¿¡
- **xv6** - ä¼˜ç§€çš„æ•™å­¦æ“ä½œç³»ç»Ÿ

---

## ğŸ“ è”ç³»æ–¹å¼

- GitHub Issues: [æŠ¥å‘Šé—®é¢˜](https://github.com/yourusername/os_debug/issues)
- æ–‡æ¡£: [åœ¨çº¿æ–‡æ¡£](docs/)
- é‚®ä»¶: your-email@example.com

---

**v2.0** - è®© OS è°ƒè¯•æ›´ç®€å•ã€æ›´æ™ºèƒ½ã€æ›´å¿«é€Ÿ ğŸš€

*"ä»å´©æºƒåˆ°ä¿®å¤ï¼Œåªéœ€å‡ ç§’é’Ÿ"*
